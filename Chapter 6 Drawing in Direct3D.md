# <element id = "6"> Chapter 6 DRAWING IN DIRECT3D </element>

在之前的章节中，我们主要是讨论了渲染管道中的一些概念和一些数学知识。
在本章中，我们就转为主要讨论`Direct3D API`，从而来配置渲染管道，编写顶点着色器和像素着色器，以及提交图形到渲染管道并且绘制它。
在本章结束的时候，我们就能够成功绘制一个立方体了。

**目标:**
- 了解一些用于定义，存储绘制图形的`Direct3D API`。
- 了解学习如何编写基础的顶点着色器和像素着色器代码。
- 了解如何使用管道状态来配置渲染管道。
- 了解如何创建一个常缓冲并且将其绑定到渲染管道中去，并且熟悉`Root Signature`(暂且叫做根特征，主要是用于定义在着色器使用哪些资源)。

## <element id = "6.1"> 6.1 VERTICES AND INPUT LAYOUTS </element>

回顾5.5.1，在`Direct3D`中，顶点除了他的位置外它还可以附加一些其他数据。
为了创建一个自定义的顶点格式，我们需要创建一个结构体来描述我们要给顶点附加的数据。
下面就举出两个不同的顶点格式的例子，其中一个附加了位置和颜色数据，另外一个附加了位置，法向量，以及两个纹理坐标数据。

```C++

struct Vertex1
{
    Float3 Pos;
    Float4 Color;
};

struct Vertex2
{
    Float3 Pos;
    Float3 Normal;
    Float2 Tex0;
    Float2 Tex1;
};

```

我们虽然定义了顶点格式，但是我们同样需要告诉`Direct3D`我们的顶点格式，不然的话`Direct3D`是没法知道我们给顶点附加了哪些额外的数据。
我们使用`D3D12_INPUT_LAYOUT_DESC`来做这件事。

```C++

struct D3D12_INPUT_LAYOUT_DESC 
{
    const D3D12_INPUT_ELEMENT_DESC *pInputElementDescs;
    UINT NumElements;
};

```

- `pInputElementDescs`: 一个数组，告诉`Direct3D`我们的顶点附加的数据信息。
- `NumElements`: 数组的大小。

`pInputElementDescs`里面的每一个元素都相当于顶点格式的一个附加数据信息。
因此如果我们的一个顶点格式他有两个附加数据信息的话，那么这个数组的大小就需要是两个。

```C++
struct D3D12_INPUT_ELEMENT_DESC
{
    LPCSTR SemanticName;
    UINT SemanticIndex;
    DXGI_FORMAT Format;
    UINT InputSlot;
    UINT AlignedByteOffset;
    D3D12_INPUT_CLASSIFICATION InputSlotClass;
    UINT InstanceDataStepRate;
};
```

- `SemanticName`: 一个用于联系元素的字符串。他的值必须在合法的范围内。我们使用这个来将顶点中的元素映射到着色器的输入数据中去。参见图片[6.1](#Image6.1)。
<img src="Images/6.1.png" id = "Image6.1"> </img>
- `SemanticIndex`: 索引值，具体可以参见图片[6.1](#Image6.1)。例如一个顶点可能会有不止一个纹理坐标，我们必须区分这些纹理坐标，因此我们就加入了索引值来区分一个顶点里面的多个纹理坐标。如果一个`semanticName`没有加上索引的话就默认为索引值为0。例如`POSITION`就是`POSITION0`。
- `Format`: 附加的数据信息的格式，类型是`DXGI_FORMAT`。
- `InputSlot`: 指定这个元素从哪个输入口进入，`Direct3D`支持16个输入口(0-15)输入顶点数据。对于现在来说，我们只使用0输入口。
- `AlignedByteOffset`: 内存偏移量，单位是字节。从顶点结构的开端到这个元素的开端的字节大小。

 